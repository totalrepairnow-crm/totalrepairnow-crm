// src/pages/ClientNew.jsx
import React, { useState } from 'react';
import ClientForm from '../components/ClientForm';
import { createClient } from '../lib/api';

export default function ClientNew() {
  const [saving, setSaving] = useState(false);
  const [err, setErr] = useState(null);

  async function handleSubmit(form) {
    setSaving(true); setErr(null);
    try {
      const payload = { ...form };
      if (!payload.empresa) throw new Error('empresa es obligatoria');

      // limpia strings vacíos -> null
      Object.keys(payload).forEach(k => { if (payload[k] === '') payload[k] = null; });

      await createClient(payload);
      window.location.href = '/'; // vuelve al dashboard/lista
    } catch (e) {
      setErr(e.message || String(e));
    } finally {
      setSaving(false);
    }
  }

  return (
    <div className="dash-wrap">
      <div className="dash-head">
        <h2 className="dash-title">Nuevo cliente</h2>
      </div>
      <ClientForm onSubmit={handleSubmit} saving={saving} error={err} />
    </div>
  );
}
import React from "react";
import { useNavigate } from "react-router-dom";
import ClientForm from "../components/ClientForm";

export default function ClientNew() {
  const navigate = useNavigate();
  return (
    <div className="container">
      <div className="dash-head">
        <h1 className="dash-title">Nuevo cliente</h1>
      </div>
      <section className="card">
        <ClientForm onSaved={(c)=> navigate(`/clients/${c.id}`)} submittingText="Creando…" />
      </section>
    </div>
  );
}
