import React from 'react'
import { createRoot } from 'react-dom/client'
import { BrowserRouter, Routes, Route, Navigate, Outlet } from 'react-router-dom'

import Header from './components/Header'
import Login from './pages/Login'
import Dashboard from './pages/Dashboard'
import Clients from './pages/Clients'
import Services from './pages/Services'
import ServiceDetail from './pages/ServiceDetail'
import ServiceNew from './pages/ServiceNew'
import ClientNew from './pages/ClientNew'
import ClientDetail from './pages/ClientDetail'
import ClientEdit from './pages/ClientEdit';
import Users from "./pages/Users.jsx";
import UserDetail from "./pages/UserDetail";
import UserEdit from "./pages/UserEdit";
import UserNew from "./pages/UserNew";


import { getToken } from './lib/api'
import './styles.css'

function Protected() {
  const authed = !!getToken()
  return authed ? <Outlet /> : <Navigate to="/login" replace />
}

function ProtectedLayout() {
  return (
    <>
      <Header />
      <div className="page">
        <Outlet />
      </div>
    </>
  )
}

createRoot(document.getElementById('root')).render(
  <BrowserRouter basename="/v2">
    <Routes>
      {/* público */}
      <Route path="/login" element={<Login />} />

      {/* redirección raíz */}
      <Route path="/" element={<Navigate to="/dashboard" replace />} />

      {/* privado (con header) */}
      <Route element={<Protected />}>
        <Route element={<ProtectedLayout />}>
          <Route path="/dashboard" element={<Dashboard />} />
          <Route path="/clients" element={<Clients />} />
          <Route path="/clients/new" element={<ClientNew />} />
          <Route path="/clients/:id/edit" element={<ClientEdit />} />
          <Route path="/clients/:id" element={<ClientDetail />} />
          <Route path="/users" element={<Users/>} />
          <Route path="/users/new" element={<UserNew/>} />
          <Route path="/users/:id" element={<UserDetail/>} />
          <Route path="/users/:id/edit" element={<UserEdit/>} />
          <Route path="/services" element={<Services />} />
          <Route path="/services/new" element={<ServiceNew />} />
          <Route path="/services/:id" element={<ServiceDetail />} />
        </Route>
      </Route>

      {/* catch-all */}
      <Route path="*" element={<Navigate to="/" replace />} />
    </Routes>
  </BrowserRouter>
)
